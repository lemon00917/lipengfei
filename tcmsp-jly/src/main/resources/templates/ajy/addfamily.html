<meta charset="utf-8">
<head>
<title>关联家人</title>
</head>
<body>
	<form class="form-horizontal" id="saveAlone" role="form">
		<div class="container-fluid">
			<div class="row clearfix">
				<div class="col-md-4 column">
					<div class="form-group">
						<div class="col-md-offset-2" id="headImg">
							<input type="hidden" name="headImg" id="thumbUrl" /> <img
								alt=".." id="thumburlShow"
								src="${request.contextPath}/img/pig2.jpg" height="128"
								width="128" style="border-radius:64px;" /> <input type="file"
								name="File" id="upImg" onchange="setImg(this)" style="height: 120px;"/>
						</div>
					</div>
				</div>
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="form-label">ID</label> <input type="text"
								class="form-control" name="userBriefid" value='${bid}'
								readonly="readonly" /> 
								<input hidden id="relationId" name="relationId" value='${rid}'>
						</div>
					</div>
				</div>
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="form-label">关系</label> <select type="text"
								class="form-control" name="relationName" style="height:35px;">
								<option selected="selected" value="0">-请选择-</option>
								<option>夫妻</option>
								<option>父女</option>
								<option>父子</option>
								<option>父亲</option>
								<option>母亲</option>
								<option>访客</option>	
							</select>
						</div>
					</div>
				</div>
			</div>
			<div class="row clearfix">
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="exampleInputEmail1">姓名</label> <input type="text"
								class="form-control" name="username" />
						</div>
					</div>
				</div>
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="form-label">性别</label> <select type="text"
								class="form-control" name="sex" style="height:35px;">
								<option selected="selected" value="0">-请选择-</option>
								<option>男</option>
								<option>女</option>

							</select>
						</div>
					</div>
				</div>
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="exampleInputEmail1">年龄</label> <input type="text"
								class="form-control" name="age" />
						</div>
					</div>
				</div>
			</div>
			<div class="row clearfix">
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="exampleInputEmail1">民族</label> <select type="text"
								class="form-control" name="nation">
								<option selected="selected" value="0">-请选择-</option>
								<option value="汉族">汉族</option>
								<option value="蒙古族">蒙古族</option>
								<option value="回族">回族</option>
								<option value="藏族">藏族</option>
								<option value="维吾尔族">维吾尔族</option>
								<option value="苗族">苗族</option>
								<option value="彝族">彝族</option>
								<option value="壮族">壮族</option>
								<option value="布依族">布依族</option>
								<option value="朝鲜族">朝鲜族</option>
								<option value="满族">满族</option>
								<option value="侗族">侗族</option>
								<option value="瑶族">瑶族</option>
								<option value="白族">白族</option>
								<option value="土家族">土家族</option>
								<option value="哈尼族">哈尼族</option>
								<option value="哈萨克族">哈萨克族</option>
								<option value="傣族">傣族</option>
								<option value="黎族">黎族</option>
								<option value="傈僳族">傈僳族</option>
								<option value="佤族">佤族</option>
								<option value="畲族">畲族</option>
								<option value="高山族">高山族</option>
								<option value="拉祜族">拉祜族</option>
								<option value="水族">水族</option>
								<option value="东乡族">东乡族</option>
								<option value="纳西族">纳西族</option>
								<option value="景颇族">景颇族</option>
								<option value="柯尔克孜族">柯尔克孜族</option>
								<option value="土族">土族</option>
								<option value="达斡尔族">达斡尔族</option>
								<option value="仫佬族">仫佬族</option>
								<option value="羌族">羌族</option>
								<option value="布朗族">布朗族</option>
								<option value="撒拉族">撒拉族</option>
								<option value="毛南族">毛南族</option>
								<option value="仡佬族">仡佬族</option>
								<option value="锡伯族">锡伯族</option>
								<option value="阿昌族">阿昌族</option>
								<option value="普米族">普米族</option>
								<option value="塔吉克族">塔吉克族</option>
								<option value="怒族">怒族</option>
								<option value="乌孜别克族">乌孜别克族</option>
								<option value="俄罗斯族">俄罗斯族</option>
								<option value="鄂温克族">鄂温克族</option>
								<option value="德昂族">德昂族</option>
								<option value="保安族">保安族</option>
								<option value="裕固族">裕固族</option>
								<option value="京族">京族</option>
								<option value="塔塔尔族">塔塔尔族</option>
								<option value="独龙族">独龙族</option>
								<option value="鄂伦春族">鄂伦春族</option>
								<option value="赫哲族">赫哲族</option>
								<option value="门巴族">门巴族</option>
								<option value="珞巴族">珞巴族</option>
								<option value="基诺族">基诺族</option>
							</select>
						</div>
					</div>
				</div>
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="exampleInputEmail1">身高</label> <input type="text"
								class="form-control" name="height" />
						</div>
					</div>
				</div>
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="exampleInputEmail1">体重</label> <input type="text"
								class="form-control" name="weight" />
						</div>
					</div>
				</div>
			</div>
			<!-- 第4行 -->
			<div class="row clearfix">
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="exampleInputEmail1">职业</label> <input type="text"
								class="form-control" name="profession" />
						</div>
					</div>
				</div>
		
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="exampleInputEmail1">电话号码</label> <input type="text"
								class="form-control" name="phone" />
						</div>
					</div>
				</div>
			</div>
			
			<!-- 第五行 -->
			<div class="row clearfix">
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="exampleInputEmail1">身份证号</label> <input type="text"
								class="form-control" name="idCard" />
						</div>
					</div>
				</div>
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="exampleInputEmail1">家庭住址</label> <input type="text"
								class="form-control" name="address" />
						</div>
					</div>
				</div>
			</div>
			<div class="row clearfix">
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="exampleInputEmail1">病史</label><br> <span
								class="radio-inline pay_list_c1 on"> <input type="radio"
								class="radioclass" name="isIllnesshistory"
								onchange="illnesshistoryDescStatus()" value="1">有
							</span> <span class="radio-inline pay_list_c1 on"> <input
								type="radio" class="radioclass" name="isIllnesshistory"
								value="0" onchange="illnesshistoryDescStatus()" checked>无
							</span>
						</div>
					</div>
				</div>
			</div>
			<!-- 第六行 -->
			<div class="row clearfix" id="illnesshistoryDesc">
				<div class="col-md-4 column" style="margin-top:20px">
					<div class="form-group">
						<div class="col-xs-8">
							<label for="exampleInputEmail1">病史说明</label>
							<textarea type="text" class="form-control"
								name="illnesshistoryDesc" rows="3" />

						</div>
					</div>
				</div>
			</div>
			<div class="row clearfix">
				<div class="col-md-12 column">
					<div class="col-md-offset-10">
						<button type="button" class="btn btn-success btn-warning btn-lg"
							style="margin-right:10px" id="addInfo">添加</button>
						<button type="button" class="btn btn-success btn-default btn-lg"
							onclick="goback()">返回</button>
					</div>
				</div>
			</div>
		</div>
	</form>
	<script>
		illnesshistoryDescStatus();
		$(function() {
			illnesshistoryDescStatus();
			$("#addInfo").click(function() {
				addFamily();
			})
		})
		
		 var relationId=$("#relationId").val();
		function illnesshistoryDescStatus() {
			var val = $('input:radio[name="isIllnesshistory"]:checked').val();
			if (val == 0) {
				$("#illnesshistoryDesc").hide();
			} else {
				$("#illnesshistoryDesc").show();
			}
		}
		//返回首页
		function goback() {
			 $('#app-content').load(contextPath+"/aFamilyMember/familyTable?rid="+relationId); 
		}
		//用于进行图片上传，返回地址
		function setImg(obj) {
			var f = $(obj).val();
			if (f == null || f == undefined || f == '') {
				return false;
			}
			if (!/\.(?:png|jpg|bmp|gif|PNG|JPG|BMP|GIF)$/.test(f)) {
				layer.msg("类型必须是图片(.png|jpg|bmp|gif|PNG|JPG|BMP|GIF)");
				$(obj).val('');
				return false;
			}
			var data = new FormData();
			$.each($(obj)[0].files, function(i, file) {
				data.append('file', file);
			});
			console.log(data);
			$.ajax({
				type : "POST",
				url : "${request.contextPath}/aFamilyMember/saveImg",
				data : data,
				cache : false,
				contentType : false, //不可缺
				processData : false, //不可缺
				dataType : "json",
				success : function(suc) {
					if (suc.code == 0) {
	
						$("#thumbUrl").val(suc.headImg); //将地址存储好
						$("#thumburlShow").attr("src", suc.headImg); //显示图片                                                              
					} else {
						layer.msg("上传失败");
						$("#url").val("");
						$(obj).val('');
					}
				},
				error : function(XMLHttpRequest, textStatus, errorThrown) {
					layer.msg("上传失败，请检查网络后重试");
					$("#url").val("");
					$(obj).val('');
				}
			});
		}
		function addFamily() {
		
			$.ajax({
				type : "POST",
				url : "${request.contextPath}/aFamilyMember/addFamily",
				data : $("#saveAlone").serialize(),
				async : false,
				success : function(data) {
					if (data.status == "TS") {
						alert("添加成功！")
						 $('#app-content').load(contextPath+"/aFamilyMember/familyTable?rid="+relationId); 
					} else {
						alert("添加失败！")
					}
				},
				error : function() {
					alert("提交失败！")
				}
			});
	
			function errorImg(img) {
				img.src = "${request.contextPath}/img/pig.jpg";
				img.onerror = null;
			}
		}
	</script>
</body>
<style>
#upImg {
	z-index: 20px;
	display: absolute;
	margin: -120px 0 0 -30px;
	opacity: 0;
	cursor: pointer;
}
</style>